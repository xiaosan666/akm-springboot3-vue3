# 工具类 Providers

项目封装了一系列工具类，通过 `this.$xxx` 的方式在组件中访问。

## 工具类列表

| 名称           | 访问方式               | 说明             |
| -------------- | ---------------------- | ---------------- |
| api            | `this.$api`            | API 接口方法     |
| http           | `this.$http`           | HTTP 请求方法    |
| helper         | `this.$helper`         | 业务相关工具方法 |
| utils          | `this.$utils`          | 通用工具方法     |
| dict           | `this.$dict`           | 字典工具         |
| validate       | `this.$validate`       | 表单验证规则     |
| security       | `this.$security`       | 安全加密工具     |
| localStorage   | `this.$localStorage`   | 本地存储         |
| sessionStorage | `this.$sessionStorage` | 会话存储         |
| eventBus       | `this.$eventBus`       | 事件总线         |

---

## this.$http - HTTP 请求

封装的 Axios 请求方法。

### 方法列表

| 方法                          | Content-Type                      | 说明          |
| ----------------------------- | --------------------------------- | ------------- |
| `get(url, data)`              | application/x-www-form-urlencoded | GET 请求      |
| `post(url, data)`             | application/json                  | POST 请求     |
| `postData(url, data)`         | application/x-www-form-urlencoded | 表单格式 POST |
| `postQueryString(url, data)`  | application/x-www-form-urlencoded | URL 参数 POST |
| `postFormData(url, data)`     | multipart/form-data               | 文件上传      |
| `postResponseBlob(url, data)` | application/json                  | 文件下载      |
| `put(url, data)`              | application/json                  | PUT 请求      |
| `del(url, data)`              | application/json                  | DELETE 请求   |

### 使用示例

```javascript
// GET 请求
this.$http.get('/api/users', { pageNum: 1, pageSize: 10 }).then(res => {
  console.log(res)
})

// POST 请求
this.$http.post('/api/user/save', { username: 'admin', name: '管理员' }).then(res => {
  this.$helper.successMessage('保存成功')
})

// 文件下载
this.$http.postResponseBlob('/api/export', { ids: [1, 2, 3] }).then(blob => {
  this.$utils.downloadBlob(blob, '导出文件.xlsx')
})
```

### 请求缓存

支持请求结果缓存：

```javascript
this.$http.post(
  '/api/config',
  {},
  {
    cacheData: true, // 启用缓存
    cacheTimeout: 60, // 缓存超时时间（秒），-1 表示永不超时
    clearCache: false, // 是否清除缓存
  }
)
```

---

## this.$helper - 业务工具

与业务或框架相关的工具方法。

### 方法列表

```javascript
// 消息提示
this.$helper.successMessage('操作成功')
this.$helper.errorMessage('操作失败')
this.$helper.warningMessage('警告信息')

// 确认弹窗
this.$helper.confirm('确定删除？').then(() => {
  // 确认操作
})

// Alert 弹窗
this.$helper.alert('提示信息').then(() => {
  // 点击确定
})

// 页面 Loading
this.$helper.showLoading()
this.$helper.hideLoading()

// 路由参数（支持刷新不丢失）
const params = this.$helper.getAndCacheRouteParams(this.$route)

// 返回上一页（保持缓存）
this.$helper.routerBackCachedView()

// CSRF Token
this.$helper.createCsrfToken()
```

---

## this.$utils - 通用工具

与业务无关的通用工具方法。

### 常用方法

```javascript
// 日期格式化
this.$utils.formatDate(new Date(), 'yyyy-MM-dd HH:mm:ss')

// 文件大小格式化
this.$utils.formatFileSize(1024) // '1 KB'

// 判断是否是图片
this.$utils.isImage('test.jpg') // true

// 下载 Blob 文件
this.$utils.downloadBlob(blob, 'filename.xlsx')

// 生成 UUID
this.$utils.uuid()
```

---

## this.$dict - 字典工具

字典数据的获取和翻译。

### 使用方法

```javascript
// 根据字典类型和值翻译名称
this.$dict.translateNameByTypeAndValue('status_type', '1') // '启用'

// 获取字典列表
this.$dict.getListByType('status_type')
// [{ name: '启用', value: '1' }, { name: '禁用', value: '0' }]

// 清除字典缓存
this.$dict.clear()
```

---

## this.$validate - 表单验证

常用的表单验证规则。

### 使用示例

```javascript
export default {
  data() {
    return {
      rules: {
        username: [
          { required: true, message: '请输入用户名', trigger: 'blur' },
          { validator: this.$validate.username, trigger: 'blur' },
        ],
        phone: [
          { required: true, message: '请输入手机号', trigger: 'blur' },
          { validator: this.$validate.phone, trigger: 'blur' },
        ],
        email: [{ validator: this.$validate.email, trigger: 'blur' }],
        idCard: [{ validator: this.$validate.idCard, trigger: 'blur' }],
      },
    }
  },
}
```

---

## this.$api - API 接口

项目公共 API 接口。

### 常用方法

```javascript
// 获取文件预览 URL
this.$api.getFileUrl('path/to/file.pdf').then(url => {
  window.open(url)
})

// 文件下载
this.$api.fileDownload('path/to/file.xlsx').then(blob => {
  this.$utils.downloadBlob(blob, 'file.xlsx')
})

// 批量下载（打包 ZIP）
this.$api.fileDownloadToZip(['path/file1.pdf', 'path/file2.pdf']).then(blob => {
  this.$utils.downloadBlob(blob, 'files.zip')
})

// 获取附件列表
this.$api.findAttachment(bizId, bizType).then(list => {
  console.log(list)
})
```

---

## this.$security - 安全工具

加密解密相关方法。

### 方法列表

```javascript
// AES 加解密
this.$security.aesEncrypt(data, key)
this.$security.aesDecrypt(data, key)

// RSA 加解密
this.$security.rsaEncrypt(data, publicKey)
this.$security.rsaDecrypt(data, privateKey)

// Base64 编解码
this.$security.base64Encode(str)
this.$security.base64Decode(str)

// 摘要算法
this.$security.md5(str)
this.$security.sha256(str)
this.$security.hmacSHA256(str, key)
```

---

## this.$localStorage / this.$sessionStorage

本地存储和会话存储的封装。

### 使用方法

```javascript
// 设置值
this.$localStorage.set('key', { name: 'value' })

// 获取值
const data = this.$localStorage.get('key')

// 删除值
this.$localStorage.remove('key')

// 清除所有
this.$localStorage.clear()
```

---

## this.$eventBus - 事件总线

组件间通信的事件总线。

### 使用方法

```javascript
// 监听事件
this.$eventBus.on('eventName', data => {
  console.log(data)
})

// 触发事件
this.$eventBus.emit('eventName', { key: 'value' })

// 移除监听
this.$eventBus.off('eventName')
```

---

## has() - 权限判断

判断当前用户是否有某个权限。

### 使用方法

```javascript
// 在模板中
;<el-button v-if="has('user_add')">新增</el-button>

// 在方法中
if (this.has('user_delete')) {
  // 有删除权限
}
```
