# 状态管理 Stores

项目使用 Pinia 进行状态管理，采用标准语法：`defineStore`、`state`、`getters`、`actions`。

## Store 列表

| Store               | 说明        |
| ------------------- | ----------- |
| `useUserStore`      | 用户状态    |
| `useConfigStore`    | 系统配置    |
| `usePermissionStore`| 权限状态    |
| `useCacheViewStore` | 页面缓存    |
| `useSwaggerApiStore`| Swagger API |

---

## useUserStore - 用户状态

管理用户信息和登录状态。

### 使用方法

```javascript
import { useUserStore } from '@/stores/user'

export default {
  methods: {
    getUserInfo() {
      const userStore = useUserStore()
      
      // 获取用户信息
      console.log(userStore.userInfo)
      console.log(userStore.token)
      console.log(userStore.username)
      
      // 设置用户信息
      userStore.setUserInfo({ username: 'admin', name: '管理员' })
      
      // 设置 Token
      userStore.setToken('Bearer xxx')
      
      // 清除用户信息（退出登录）
      userStore.clearUserInfo()
    }
  }
}
```

### State

| 属性       | 类型   | 说明          |
| ---------- | ------ | ------------- |
| token      | String | 登录 Token    |
| csrfToken  | String | CSRF Token    |
| userInfo   | Object | 用户信息      |
| userAvatar | String | 用户头像 URL  |

---

## useConfigStore - 系统配置

管理系统配置信息。

### 使用方法

```javascript
import { useConfigStore } from '@/stores/config'

export default {
  methods: {
    getConfig() {
      const configStore = useConfigStore()
      
      // 获取配置
      console.log(configStore.enabledEncrypt)  // 是否启用加密
      console.log(configStore.enabledSign)     // 是否启用签名
      console.log(configStore.activeProfile)   // 当前环境
      
      // 获取并设置系统配置（通常在登录时调用）
      configStore.getAndSetSysConfig()
    }
  }
}
```

### State

| 属性              | 类型    | 说明                       |
| ----------------- | ------- | -------------------------- |
| hasConfig         | Boolean | 是否已获取配置             |
| activeProfile     | String  | 激活的环境（dev/test/prod）|
| publicKey         | String  | RSA 公钥                   |
| privateKey        | String  | RSA 私钥                   |
| enabledEncrypt    | Boolean | 是否启用加解密             |
| encryptExcludeUris| Array   | 加解密白名单               |
| enabledSign       | Boolean | 是否启用签名               |
| signExcludeUris   | Array   | 签名白名单                 |

---

## usePermissionStore - 权限状态

管理菜单和按钮权限。

### 使用方法

```javascript
import { usePermissionStore } from '@/stores/permission'

export default {
  methods: {
    checkPermission() {
      const permissionStore = usePermissionStore()
      
      // 获取菜单列表
      const menus = permissionStore.permissionMenu.menus
      
      // 获取按钮权限列表
      const buttonCodes = permissionStore.permissionMenu.buttonCodeList
      
      // 判断是否有某个权限
      const hasPermission = buttonCodes.includes('user_add')
      
      // 设置权限菜单
      permissionStore.setPermissionMenu(menuData)
      
      // 清除权限
      permissionStore.clearPermissionMenu()
    }
  }
}
```

### State

| 属性                           | 类型    | 说明                    |
| ------------------------------ | ------- | ----------------------- |
| permissionMenu                 | Object  | 权限菜单对象            |
| permissionMenu.menus           | Array   | 菜单列表                |
| permissionMenu.buttonCodeList  | Array   | 按钮权限编码列表        |
| pageMainLoading                | Boolean | 页面主区域 Loading 状态 |

---

## useCacheViewStore - 页面缓存

管理 keep-alive 缓存的页面。

### 使用方法

```javascript
import { useCacheViewStore } from '@/stores/cacheView'

export default {
  methods: {
    manageCacheView() {
      const cacheViewStore = useCacheViewStore()
      
      // 获取缓存的组件名列表
      const cachedViews = cacheViewStore.cachedView
      
      // 添加缓存
      cacheViewStore.addCachedView('UserList')
      
      // 移除缓存
      cacheViewStore.removeCachedView('UserList')
      
      // 清除所有缓存
      cacheViewStore.clearCachedView()
    }
  }
}
```

### State

| 属性       | 类型  | 说明               |
| ---------- | ----- | ------------------ |
| cachedView | Array | 缓存的组件名列表   |

---

## 全局清除方法

一键清除所有 Store 状态（退出登录时使用）。

```javascript
import { clearAllStores } from '@/stores'

export default {
  methods: {
    logout() {
      // 清除所有状态
      clearAllStores()
      
      // 跳转到登录页
      this.$router.replace('/login')
    }
  }
}
```

---

## Store 规范

### 定义 Store

```javascript
import { defineStore } from 'pinia'

export const useExampleStore = defineStore('example', {
  // 状态
  state: () => ({
    count: 0,
    list: []
  }),
  
  // 计算属性
  getters: {
    doubleCount: (state) => state.count * 2
  },
  
  // 方法
  actions: {
    increment() {
      this.count++
    },
    
    async fetchList() {
      const res = await api.getList()
      this.list = res
    }
  },
  
  // 持久化配置（可选）
  persist: {
    key: 'example-store',
    storage: sessionStorage
  }
})
```

### 在组件中使用

```javascript
import { useExampleStore } from '@/stores/example'

export default {
  computed: {
    count() {
      const store = useExampleStore()
      return store.count
    }
  },
  
  methods: {
    handleClick() {
      const store = useExampleStore()
      store.increment()
    }
  }
}
```

