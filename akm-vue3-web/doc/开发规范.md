# 开发规范

## Vue 组件规范

### 使用选项式 API (Options API)

```javascript
export default {
  name: 'UserList',
  
  props: {
    userId: {
      type: String,
      required: true
    }
  },
  
  data() {
    return {
      loading: false,
      list: []
    }
  },
  
  computed: {
    filteredList() {
      return this.list.filter(item => item.active)
    }
  },
  
  created() {
    this.fetchData()
  },
  
  methods: {
    async fetchData() {
      this.loading = true
      try {
        this.list = await this.$http.get('/api/users')
      } finally {
        this.loading = false
      }
    }
  }
}
```

### 组件命名

| 类型     | 命名规则   | 示例                         |
| -------- | ---------- | ---------------------------- |
| 组件名   | PascalCase | `UserList`、`TheHeader`      |
| 文件名   | kebab-case | `user-list.vue`、`index.vue` |
| 页面组件 | 目录形式   | `views/user/index.vue`       |
| 弹窗组件 | The 前缀   | `TheUserAddEditDialog.vue`   |

---

## 模板语法规范

### 使用 v-slot 语法

```vue
<!-- ✅ 正确 -->
<template v-slot:header>标题</template>
<template v-slot="{ row }">{{ row.name }}</template>

<!-- ❌ 错误：不使用简写 -->
<template #header>标题</template>
<template #default="{ row }">{{ row.name }}</template>
```

### Element Plus 图标使用

```vue
<template>
  <!-- 使用 el-icon 包裹图标组件 -->
  <el-button type="primary">
    <el-icon><Plus /></el-icon>
    新增
  </el-button>
  
  <el-icon><Search /></el-icon>
</template>
```

---

## 样式规范

### 使用 SCSS + scoped

```vue
<style lang="scss" scoped>
.user-list {
  padding: 16px;
  
  .header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 16px;
  }
  
  .table-wrapper {
    background: #fff;
    border-radius: 4px;
  }
}
</style>
```

### 类名命名

- 使用 kebab-case
- 采用 BEM 或层级嵌套

```scss
// kebab-case
.user-list {}
.user-list-header {}
.user-list-content {}

// 层级嵌套
.user-list {
  .header {}
  .content {}
}
```

---

## Pinia Store 规范

### Store 定义

```javascript
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  // state 使用函数返回对象
  state: () => ({
    userInfo: null,
    token: ''
  }),
  
  // getters 通过 state 参数访问状态
  getters: {
    username: (state) => state.userInfo?.username || ''
  },
  
  // actions 通过 this 访问和修改状态
  actions: {
    setUserInfo(info) {
      this.userInfo = info
    },
    
    async fetchUserInfo() {
      const res = await http.get('/api/user/info')
      this.userInfo = res
    }
  }
})
```

### Store 命名

- 文件名：camelCase，如 `user.js`
- 导出名：use + 名称 + Store，如 `useUserStore`

---

## API 和工具类规范

### API 调用

```javascript
// 使用 this.$http
this.$http.post('/api/user/save', data)
  .then(res => {
    this.$helper.successMessage('保存成功')
  })
  .catch(err => {
    this.$helper.errorMessage(err.msg || '保存失败')
  })

// 使用 this.$api
this.$api.getFileUrl(objectKey).then(url => {
  window.open(url)
})
```

### 错误处理

```javascript
async fetchData() {
  try {
    this.loading = true
    const res = await this.$http.post('/api/list', this.queryParams)
    this.tableData = res.list
    this.total = res.total
  } catch (err) {
    this.$helper.errorMessage(err.msg || '获取数据失败')
  } finally {
    this.loading = false
  }
}
```

---

## 路由规范

### 路由配置

```javascript
{
  path: '/sys/user',
  name: 'SysUser',
  component: () => import('@/views/sys/user/index.vue'),
  meta: { 
    title: '用户管理',
    keepAlive: true  // 是否缓存
  }
}

// 带参数的路由
{
  path: '/sys/user/view/:id',    // 必填参数
  path: '/sys/user/view/:id?',   // 可选参数
  name: 'SysUserView',
  ...
}
```

### 路由跳转

```javascript
// 使用 name 跳转（推荐）
this.$router.push({
  name: 'SysUserView',
  params: { id: row.id }
})

// 使用 path 跳转
this.$router.push('/sys/user')

// 使用 query 传参
this.$router.push({
  name: 'SysUserView',
  query: { id: row.id, type: 'view' }
})
```

### 获取路由参数

```javascript
// 推荐：使用 helper 方法（支持刷新不丢失）
const params = this.$helper.getAndCacheRouteParams(this.$route)
const id = params.id

// 直接获取（刷新可能丢失）
const id = this.$route.params.id
const type = this.$route.query.type
```

---

## 表单验证规范

```javascript
export default {
  data() {
    return {
      form: {
        username: '',
        phone: '',
        email: ''
      },
      rules: {
        username: [
          { required: true, message: '请输入用户名', trigger: 'blur' },
          { min: 2, max: 20, message: '长度在 2 到 20 个字符', trigger: 'blur' }
        ],
        phone: [
          { required: true, message: '请输入手机号', trigger: 'blur' },
          { validator: this.$validate.phone, trigger: 'blur' }
        ],
        email: [
          { validator: this.$validate.email, trigger: 'blur' }
        ]
      }
    }
  },
  
  methods: {
    async handleSubmit() {
      try {
        await this.$refs.form.validate()
        // 验证通过，提交表单
        await this.$http.post('/api/user/save', this.form)
        this.$helper.successMessage('保存成功')
      } catch (err) {
        // 验证失败或请求失败
        if (err.msg) {
          this.$helper.errorMessage(err.msg)
        }
      }
    }
  }
}
```

---

## 文件组织规范

### 页面目录结构

```
views/sys/user/
├── index.vue              # 列表页
├── TheUserAddEdit.vue     # 新增/编辑弹窗
├── TheUserMenuTree.vue    # 菜单树弹窗
└── TheResetPassword.vue   # 重置密码弹窗
```

### 组件目录结构

```
components/akm-table/
└── index.vue              # 组件入口
```

---

## 注释规范

### 文件头注释

```javascript
/**
 * 用户管理
 * @description 用户列表、新增、编辑、删除
 */
```

### 方法注释

```javascript
/**
 * 获取用户列表
 * @param {number} pageNum - 页码
 * @param {number} pageSize - 每页条数
 */
fetchUserList(pageNum, pageSize) {
  // ...
}
```

### 行内注释

```javascript
// 计算表格高度
const height = this.$helper.computedTableHeight()
```

