<?xml version="1.0" encoding="UTF-8"?>
<configuration>

  <!-- 日志根目录-->
  <springProperty scope="context" name="LOG_HOME" source="logging.file.path" defaultValue="./logs"/>

  <!-- 日志级别 -->
  <springProperty scope="context" name="LOG_ROOT_LEVEL" source="logging.level.root" defaultValue="INFO"/>

  <!--  标识这个"STDOUT" 将会添加到这个logger -->
  <springProperty scope="context" name="STDOUT" source="log.stdout" defaultValue="STDOUT"/>

  <!-- 日志文件名称-->
  <property name="LOG_PREFIX" value="log"/>

  <!-- 日志文件编码-->
  <property name="LOG_CHARSET" value="UTF-8"/>

  <!-- 日志文件路径+日期-->
  <property name="LOG_DIR" value="${LOG_HOME}/%d{yyyyMMdd}"/>

  <!--对日志进行格式化-->
  <property name="LOG_MSG" value="[%d{yyyy-MM-dd HH:mm:ss:SSS}] %thread %level %logger{36} - %msg%n "/>

  <!--对日志进行格式化（彩色）-->
  <property name="LOG_MSG_COLOR"
            value="%red(%d{yyyy-MM-dd HH:mm:ss.SSS}) %green([%thread]) %highlight(%-5level) %boldMagenta(%logger) - %cyan(%msg%n)"/>

  <!--文件大小，默认10MB-->
  <property name="MAX_FILE_SIZE" value="20MB"/>

  <!-- 配置日志的滚动时间 ，表示只保留最近 90 天的日志-->
  <property name="MAX_HISTORY" value="90"/>

  <!--输出到控制台-->
  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <!-- 输出的日志内容格式化（使用 encoder 替代 layout）-->
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <pattern>${LOG_MSG_COLOR}</pattern>
      <charset>${LOG_CHARSET}</charset>
    </encoder>
  </appender>

  <!-- 定义 ALL 日志的输出方式:-->
  <appender name="FILE_ALL" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <!--日志文件路径，日志文件名称-->
    <File>${LOG_HOME}/all_${LOG_PREFIX}.log</File>

    <!-- 设置滚动策略（使用 SizeAndTimeBasedRollingPolicy 替代已弃用的 SizeAndTimeBasedFNATP）-->
    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
      <!--日志文件路径，新的 ALL 日志文件名称，" i " 是个变量 -->
      <FileNamePattern>${LOG_DIR}/all_${LOG_PREFIX}%i.log</FileNamePattern>

      <!-- 配置日志的滚动时间-->
      <MaxHistory>${MAX_HISTORY}</MaxHistory>

      <!--当天的日志大小超过 ${MAX_FILE_SIZE} 文件大小时候，新的内容写入新的文件-->
      <maxFileSize>${MAX_FILE_SIZE}</maxFileSize>

      <!-- 所有日志文件的总大小限制（可选，避免占用过多磁盘空间）-->
      <totalSizeCap>10GB</totalSizeCap>
    </rollingPolicy>

    <!-- 输出的日志内容格式化（使用 encoder 替代 layout）-->
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <pattern>${LOG_MSG}</pattern>
      <charset>${LOG_CHARSET}</charset>
    </encoder>
  </appender>

  <!-- 定义 ERROR 日志的输出方式:-->
  <appender name="FILE_ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <!-- 下面为配置只输出error级别的日志 -->
    <filter class="ch.qos.logback.classic.filter.LevelFilter">
      <level>ERROR</level>
      <OnMismatch>DENY</OnMismatch>
      <OnMatch>ACCEPT</OnMatch>
    </filter>
    <!--日志文件路径，日志文件名称-->
    <File>${LOG_HOME}/err_${LOG_PREFIX}.log</File>

    <!-- 设置滚动策略（使用 SizeAndTimeBasedRollingPolicy 替代已弃用的 SizeAndTimeBasedFNATP）-->
    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
      <!--日志文件路径，新的 ERR 日志文件名称，" i " 是个变量 -->
      <FileNamePattern>${LOG_DIR}/err_${LOG_PREFIX}%i.log</FileNamePattern>

      <!-- 配置日志的滚动时间 -->
      <MaxHistory>${MAX_HISTORY}</MaxHistory>

      <!--当天的日志大小超过 ${MAX_FILE_SIZE} 文件大小时候，新的内容写入新的文件-->
      <maxFileSize>${MAX_FILE_SIZE}</maxFileSize>

      <!-- 所有错误日志文件的总大小限制（可选）-->
      <totalSizeCap>5GB</totalSizeCap>
    </rollingPolicy>

    <!-- 输出的日志内容格式化（使用 encoder 替代 layout）-->
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <pattern>${LOG_MSG}</pattern>
      <charset>${LOG_CHARSET}</charset>
    </encoder>
  </appender>

  <!-- additivity 设为false,则logger内容不附加至root ，配置以配置包下的所有类的日志的打印，级别是 ERROR-->
  <logger name="org.springframework" level="ERROR"/>
  <logger name="org.apache.commons" level="ERROR"/>

  <!--开发环境:打印控制台-->
  <springProfile name="dev,test">
    <logger name="com.akm.springboot" level="INFO"/>
  </springProfile>

  <!-- ${LOG_ROOT_LEVEL} 日志级别 -->
  <root level="${LOG_ROOT_LEVEL}">

    <!-- 标识这个"${STDOUT}"将会添加到这个logger -->
    <appender-ref ref="${STDOUT}"/>

    <!-- FILE_ALL 日志输出添加到 logger -->
    <appender-ref ref="FILE_ALL"/>

    <!-- FILE_ERROR 日志输出添加到 logger -->
    <appender-ref ref="FILE_ERROR"/>
  </root>

</configuration>
